<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>GPG یک راهنمای نسبتا مفصل &middot; </title>

  
  <link rel="stylesheet" href="http://fzero.rubi.gd/css/poole.css">
  <link rel="stylesheet" href="http://fzero.rubi.gd/css/hyde.css">
  <link rel="stylesheet" href="http://fzero.rubi.gd/css/poole-overrides.css">
  <link rel="stylesheet" href="http://fzero.rubi.gd/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://fzero.rubi.gd/css/hyde-x.css">
  <link rel="stylesheet" href="http://fzero.rubi.gd/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="http://fzero.rubi.gd/css/hacks.css">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://fzero.rubi.gd/touch-icon-144-precomposed.png">
  <link href="http://fzero.rubi.gd/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="یک وبلاگ دیگر از یک برنامه نویس دیگر">
  <meta name="keywords" content="gpg,pgp,git,gnupg">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-76159433-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body class="theme-base-0d">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
        <img src="https://www.gravatar.com/avatar/8c7e4f1f1f59ff04755adc03ab2a1dab?s=200"
             alt="gravatar" title="">
      
      <h1></h1>
      <p class="lead">یک وبلاگ دیگر از یک برنامه نویس دیگر</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://fzero.rubi.gd/">وبلاگ</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="https://github.com/fzerorubigd"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      
      
      
      <a href="https://twitter.com/fzerorubigd"><i class="fa fa-twitter-square fa-3x"></i></a>
      
      <a href="http://fzero.rubi.gd/index.xml" type="application/rss+xml"><i class="fa fa-rss-square fa-3x"></i></a>
      </li>
    </ul>

    

    <p>Copyright &copy; 2016 <a href="http://fzero.rubi.gd/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">GPG یک راهنمای نسبتا مفصل</h1>
    <span class="post-date">Apr 8, 2016 &middot; 15 minute read &middot; <a href="http://fzero.rubi.gd/post/general/gpg-step-by-step/#disqus_thread">Comments</a>
    
    <br/>
    <a class="label" href="http://fzero.rubi.gd/categories/gpg">gpg</a><a class="label" href="http://fzero.rubi.gd/categories/pgp">pgp</a><a class="label" href="http://fzero.rubi.gd/categories/git">git</a>
    </span>
    

<h1 id="gpg-یا-pgp-چی-هست-اصلا:15e4b036b1a6dfc4502d5b7e8e5dc87b">GPG یا PGP چی هست اصلا؟</h1>

<p>این یک الگوریتم رمز گذاری شخصی حساب میشه. در حقیقت PGP اون الگوریتمه، و من از برنامه آزاد GPG برای مدیریتش استفاده میکنم.
درسته که بگم این این کلید PGP منه، ولی حقیقت اینه که ناخواسته خیلی وقتا متوجه میشم که گفتم این کلید GPG منه، عمدی نیست ولی از لحاظ تکنیکی اگه اهل خورده گرفتن باشی غلط میتونه باشه.</p>

<p>من سعی دارم تو این نوشته، توضیح بدم که چطور میشه یه کلید ساخت و مطمئن شد که امنه. این روش منه، روشی که من بعد از یکی دو سال رسیدم بهش، ولی دلیل نمیشه که این روش کامل باشه. روشی شما ممکنه متفاوت باشه و برای شما ایده‌آل تر باشه، پس اگه جایی به نظرتون غلط بود بگید حتما تا اصلاح کنم، ولی اگه به اندازه کافی ایده آل شما نبود، خوشحال میشم که بشنوم روشتونو، ولی ممکنه که اعمال نکنم اون تغییری که به نظر شما این مطلب رو ایده‌آل میکنه :)</p>

<h1 id="از-کجا-شروع-کنم:15e4b036b1a6dfc4502d5b7e8e5dc87b">از کجا شروع کنم؟</h1>

<p>مطمئن بشید که نسخه آخر gpg روی سیستم شما نصبه. الان و در زمان نوشتن این نوشته نسخه ۲.۱.۱۱ آخرین نسخه رسمی gpg توی <a href="https://gnupg.org/index.html">سایتشه</a>. البته نسخه کلاسیک هم هست و نسخه استیبل، که خوب من همیشه دوست دارم لبه باشم.</p>

<pre><code>gpg --version
gpg (GnuPG) 2.1.11
libgcrypt 1.6.5
Copyright (C) 2016 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Home: ~/.gnupg
Supported algorithms:
Pubkey: RSA, ELG, DSA, ECDH, ECDSA, EDDSA
Cipher: IDEA, 3DES, CAST5, BLOWFISH, AES, AES192, AES256, TWOFISH,
        CAMELLIA128, CAMELLIA192, CAMELLIA256
Hash: SHA1, RIPEMD160, SHA256, SHA384, SHA512, SHA224
Compression: Uncompressed, ZIP, ZLIB, BZIP2
</code></pre>

<p>تو این سیستم، یک کلید عمومی وجود داره و یک کلید خصوصی. مشخصه که کلید عمومی رو میشه خیلی راحت انتشار داد و در اختیار عموم گذاشت. ولی تکلیف کلید خصوصی  مشخص تره.
این کلید نباید تحت هیچ شرایطی بره رو اینترنت :)‌کلا هیچ جا نبریتش، ایده آل ترین جا براش یک سیستم کاملا ایزولست که اصلا به اینترنت دسترسی نداشته باشه. منتها چطور ازش استفاده کنیم اونوقت؟
مثلا من همه کامیتهام توی git رو ساین میکنم. اینجوری باید هر کامیت رو ببرم روی اون ماشین ایزوله و ساین کنم و برگردونم؟ قطعا نه. تو اینجا من سعی میکنم که روش رو توضیح بدم که هم کلید شما امن باشه و هم اینکه شما بتونید بی دردسر از کلیدتون استفاده کنید.</p>

<p>خوب قدم به قدم بریم جلو حتمالا خیلی بهتر میشه :)</p>

<h1 id="ساخت-یک-کلید-امن-قدم-به-قدم:15e4b036b1a6dfc4502d5b7e8e5dc87b">ساخت یک کلید امن، قدم به قدم</h1>

<h2 id="ساخت-کلید:15e4b036b1a6dfc4502d5b7e8e5dc87b">ساخت کلید</h2>

<p>برای ساخت کلید، <code>gpg --full-gen-key</code> کمکتون میکنه.
&ndash; برای اینکه پروسه زدن رمز مشخص نبود توی اسکی نما، دوباره دارم رکورد میکنم اونها رو با‍ <code>pinentry-course</code> و داخل داکر. داکر دبیان هم دارم که gpg اصلیش نسخه ۱ ـه و من نسخه ۲ رو جدا گانه نصب کردم که قدیمیتر از ۲.۱.۱۱ است و دستور <code>--full-gen-key</code> رو نداره. برای همین <code>--gen-key</code> رو استفاده میکنم.</p>

<script type="text/javascript" src="https://asciinema.org/a/b2jy7v73ddnpvl40e2k5tuay7.js" id="asciicast-b2jy7v73ddnpvl40e2k5tuay7" async></script>

<p>من همه جوابها رو کامل دادم، حتی اونها که جواب پیشفرضشون درست بود. مراحل سادست. اول الگوریتم رو انتخاب میکنیم که پیشفرضش خوبه، بعد میگه که اندازه کلیدی RSA رو بگو. پیشفرض خودش ۲۰۴۸ رو انتخاب نکنید.
این کلید هر چی بلند تر باشه امنتره. گام بعدی اینه که ازتون میپرسه میخواید این کلید چند وقت معتبر باشه. من زدم برای همیشه، این خیلی بهتره. در حقیقت کلید اصلی رو به برای همیشه انتخاب میکنیم، کلید های بعدی که به عنوان sub key سا همون زیر کلید استفاده میشن رو،‌با زمانهای کمتر درست خواهیم کرد :)
گامهای بعدی هم که اسم و مشخصاتتون رو میپرسه که خوب شما مشخصات خودتون رو میزنید طبیعتا. یک ایمیل هم اینجا میخواد که شما ایمیل اصلیتون رو بزنید، ایمیلهای دیگه رو هم میشه بعدا اضافه کرد.</p>

<p>بعدش از شما رمز میخواد. بسته به <code>pinentry</code> نصب شده روی سیستم شما، این گرفتن رمز ممکنه با روش متفاوتی از شما گرفته بشه. برای من توی X11 گرفته میشه (رکورد جدید توی داکره و توی ترمینال گرفته میشه رمز) ولی میتونید ‍‍<code>pinentry-curses</code> رو تنظیم کنید تا اونم توی ترمینال باشه که خوب برای من زیاد مهم نیست :)</p>

<p>یه نکته دیگه. اگه کار وقت گیری دارید، مثلا کپی کردن و اپتیمایز کردن هاردتون، یا هر کار دیگه ای که میتونه بی نظمی تولید کنه، بهترین وقتش همین موقع است. هر چی سر سیستموتون شلوغ باشه کلید رندومی که تولید میکنه اعتبار بیشتری داره. یعنی رندوم تره :) -خیلی عبارت مسخره ایه رندوم تر!-</p>

<p>کامپیوتر معمولا تو یه سری رندوم درست میکنه. من بارها سر ملت رو با این روش کلاه گذاشتم :) مثلا یه برنامه بود که رندم یه نفر رو انتخب میکرد که بره ظرف بشوره تو خوابگاهمون با هم اتاقی ها. من همیشه طوری سید رو تغییر میدادم که خودم انتخاب نشم، مگه روزهایی که ظرفها کم بود.</p>

<p>اینطوری، در زمانی که gpg داره کلید رندوم رو برای شما ایجاد میکنه، کلی کلید رندوم صرف برنامه های دیگه میشن، و رندومهای استفاده شده تو یه سری پشت سر هم درنمیان، البته خود gpg به این بسنده نمیکنه و کلی کلک دیگه هم میزنه که قطعا هر چی این بی نظمی بیشتر باشه تو سیستم شما، کلید تولید شده امنیت بیشتری داره.</p>

<p>این کلید ،کلید اصلی شماست. همون کلیدی که باید بذاریتش تو صندوق کلیدشم قورت بدید :)</p>

<p>یه سری کارهای دیگه هم هست، مثلا اینکه عکس اضافه کنید یا اینکه الگوریتم هش رو تغییر بدید به یه روش قدرتمندتر، اینها رو من بعدا اضافه میکنم به همین پست :) شاید هم آخرش این متن رو عوض کردم :)</p>

<h2 id="اضافه-کردن-زیر-کلید-subkey:15e4b036b1a6dfc4502d5b7e8e5dc87b">اضافه کردن زیر کلید (subkey)</h2>

<p>مساله از همینجا شروع میشه. من میخوام کلیدم رو ببرم رو سیستم شرکت که کمتر از لپتاپ خودم به امنیتش اطمینان دارم. یا اصلا اگه لپتاپم و دزدیدن چی؟</p>

<p>بهترین کار اینه که یه زیر کلید اضافه کنیم به این کلید، بعد یه جوری یه نسخه ازش تهیه کنیم که کلید اصلی توش نباشه. نسخه کاملش رو بفرستیم یه جای امن، و این نسخه جدید رو استفاده کنیم.
علاوه بر این یه روشی هم داشته باشیم که بتونیم اون کلید رو هم provoke کنیم وقتی لازم شد.</p>

<p>خوب اول یه <code>subkey</code>
من معمولا از این کلید برای ساین کردن کامیتها و تگها استفاده میکنم توی <code>git.</code> خوب پس یه کلید میخوام برای امضا کردن. ممکنه یه جایی برای encrypt کردن بخواید استفاده کنید ازش، همین مراحل رو میتونید برای اونکار هم انجام بدید.</p>

<p>اول کلید رو برای ویرایش باز کنید. ‍‍<code>gpg --edit-key your@email.com</code> این همون آدرس ایمیلیه که توی قسمت ساخت کلید زدید.</p>

<script type="text/javascript" src="https://asciinema.org/a/2vqrwjohchk5xxspvyqkeril1.js" id="asciicast-2vqrwjohchk5xxspvyqkeril1" async></script>

<p>گام اول اینه که توی ترمینالی که <code>gpg‍‍</code> در اختیارتون میذاره، <code>addkey</code> رو تایپ کنید.
اول ازتون میپرسه چه کلیدی میخواید و برای چه کاری. من برای امضا کردن میخوام، پس <code>(4) RSA (sign only )</code> رو با زدن کلید ۴ انتخاب میکنم.</p>

<p>بعدش ازم میپرسه برای چند وقت میخواید این کلید معتبر باشه. من اینجا دو سال رو انتخاب کردم. میتونید بزنید مادام‌العمر یا کمتر یا بیشتر از دو سالی که من زدم.  ولی من ترجیحم اینه که بدونم کلید واقعا کی منقضی میشه. اینو خودتون میتونید بسته به شرایط تصمیم بگیرید. مثلا من یه کلید دارم روی لپتاپ خودم که تاریخ انقضا نداره، ولی یه کلید هست روی یه سرور که برای ساین استفاده میکنم ازش و تاریخ انقضاش یک ساله.</p>

<p>بعدش از شما یه سری رمز میپرسه. الیش که رمز کلید تازه ایجاد شدست. بعد ممکنه رمز کلید اصلی رو بپرسه. مثلا برای من نپرسید، چون من <code>gpg-agent</code> روی لپتاپم در حال اجرا بود و تا یه مدتی دیگه رمز نمیپرسه برای کلید.
دقت کنید قاعدتا اینوریه که اول رمز کلید جدید رو میگیره، بعد رمز کلید اصلی رو میپرسه، و بعد مجددا رمز کلید جدید رو هم میپرسه.</p>

<p>گام آخر این که توی ترمینال بنویسید <code>save</code> و کلید رو ذخیره کنید. حالا یک کلید برای ساین دارید که به جای کلید اصلی از اون استفاده مشه. یعنی هر وقت برای ساین از شما رمز بخواد، رمز این کلید رو میزنید نه رمز کلید اصلی رو .</p>

<h2 id="گواهی-فوت:15e4b036b1a6dfc4502d5b7e8e5dc87b">گواهی فوت؟؟</h2>

<p>حالا میرسیم به این بحث که اگه کلید دزدیده شد چکار کنم؟ اگه کلید دوم دزدیده بشه و شما همچنان اصلی رو داشته باشید به راحتی میشه کلید رو <code>revoke</code> کرد، ولی اگه کلید اصلی دزدیده بشه، چی؟</p>

<p>برای اینکار یه ‍‍<code>revocation certificate</code> درست میکنیم. دقیقا مثل بیمست :) که میگن امیدوارم هیچوقت مورد استفادتون نشه :))))) ولی خوب به هر حال.</p>

<pre><code>gpg --output gpg-revocation-certificate-fzero-rubi-gd --gen-revoke fzero@rubi.gd 
</code></pre>

<p>اسم فایل خروجی مهم نیست، ولی آدرس ایمیل، همونیه که برای ساختش استفاده کردید.</p>

<p>خوب این یه فایله که اگه به اندازه من حساسیت داشته باشید، پرینتش میکنید و یه جا توی یکی از کتابهاتون مخفیش میکنید. خودش هم ممکنه یه جایی نگه دارید، ول قطعا اون یه جا توی اینترنت نیست!!! یا حتی توی یه جایی که ظاهرا امنه مثل <code>mega</code> یا هر چیز مشابه دیگه ای. بهترین کاری که میشه کرد اینه که از اینترنت دورش کنید.
و البته طبیعتا اینو کنار کلید اصلی - که به زودی میگم چجوری اون رو هم <code>export</code> کنید، قرار ندید. چون این قراره که در صورت گم شدن اون، ازش محافظت کنه، نه که خودشم باهاش گم بشه :)</p>

<script type="text/javascript" src="https://asciinema.org/a/bk6uhfv5bzeth3unvxfqkzj53.js" id="asciicast-bk6uhfv5bzeth3unvxfqkzj53" async></script>

<p>ازتون یه دلیل میپرسه، که میتونید یه شماه انتخاب کنید بعد یه جمله از شما میگیره به عنوان توضیح که میتونید حالی بگذارید اصلا. در نهایت ازتون رمز رو میپرسه که خوب، منطقا باید رمز رو بزنید تا بتونه این گواهی رو تولید کنه.</p>

<h2 id="خروجی-کلید-ها:15e4b036b1a6dfc4502d5b7e8e5dc87b">خروجی کلید ها</h2>

<p>حالا وقت خروجی گرفتن از کلیدهاست.
اول کلید عمومی :</p>

<pre><code>gpg --export --armor fzero@rubi.gd &gt; public-gpg-key-fzero-rubi-gd.public
</code></pre>

<p>آدرس فایل رو هر چی میخواید بدید. من برای خودم یه کانونشن دارم که کلید های عمومی رو با پسوند ‍<code>public</code> و کلید های خصوصی رو با پسوند <code>private</code> ازشون <code>export</code> میگیرم.</p>

<p>این کلید رو میتونید به هر نحوی که میدونید امنه منتشر کنید. البته از پابلیک سرورها هم میتونید استفده کنی که آخر نوشته مینویسم چطوری.</p>

<p>خوب گام مهم، گرفتن کلید اختصاصی شماست.</p>

<pre><code>gpg --export-secret-keys --armor fzero@rubi.gd &gt; private-gpg-key-fzeo-rubi-gd.private
</code></pre>

<p>این اول رمز کلید اصلی رو میپرسه، بعد به ازای تک تک زیرکلیدهایی که ساختید ازتون رمز میپرسه.</p>

<p>نتیجه یه فایله که کاملا باید از درسترس دیگران و همچنین اینترنت دور باشه.</p>

<h2 id="حذف-کلید-اصلی-master:15e4b036b1a6dfc4502d5b7e8e5dc87b">حذف کلید اصلی (master)</h2>

<p>خوب این فایل اصلی که قراره تو یه جای امن ذخیره بشه. گام بعدی حذف کلید اصلی از این سیستم و ایجد یه کلید gpg بدون کلید اصلی ولی همچنان با قابلیت امضا و/یا کدگذاریه.</p>

<h3 id="export-subkey:15e4b036b1a6dfc4502d5b7e8e5dc87b">export subkey</h3>

<pre><code>gpg --export-secret-subkeys fzero@rubi.gd &gt; subkey-temporary
</code></pre>

<p>اول رمز کلید اصلی رو بزنید بعد رمز زیرکلیدها رو.</p>

<h3 id="گام-بعدی-حذف-کلید-اصلی:15e4b036b1a6dfc4502d5b7e8e5dc87b">گام بعدی حذف کلید اصلی</h3>

<pre><code>gpg --delete-secret-key fzero@rubi.gd
</code></pre>

<p>چندین و چند بار ازتون میپرسه که حذف کنم؟ مطمئنی؟ شما همه رو جواب بدید که حذف کن. رمز هم اگه پرسید طبیعتا بزنید.</p>

<h3 id="برگردوندن-زیر-کلیدها:15e4b036b1a6dfc4502d5b7e8e5dc87b">برگردوندن زیر کلیدها</h3>

<pre><code>gpg --import subkey-temporary
</code></pre>

<p>که بعد از یه سری پرسیدن رمز - که دیگه نمینویسم، خودتون هر وقت رمز خواست بزنید - یه همچین چیزی تو خروجی میبیید :</p>

<pre><code>gpg --import subkey-temporary
gpg: key 09ABEE4C: &quot;Forud (This is an example) &lt;fzero@rubi.gd&gt;&quot; not changed
gpg: To migrate 'secring.gpg', with each smartcard, run: gpg --card-status
gpg: key 09ABEE4C: secret key imported
gpg: Total number processed: 5
gpg:              unchanged: 1
gpg:       secret keys read: 5
gpg:   secret keys imported: 3
</code></pre>

<p>گام آخر اینه که فایل <code>subkey-temporary</code> رو سر به نیست کنید. با هر ابزاری که دوست دارید، مثلا</p>

<pre><code>shred --remove subkey-temporary 
</code></pre>

<p>حالا با دستور ‍<code>gpg --list-secret-keys</code> یه همچین چیزی میبینید :</p>

<pre><code>/home/f0rud/.gnupg/pubring.kbx
------------------------------
sec#  rsa4096/09ABEE4C 2016-04-08 [SC]
uid         [ultimate] Forud (This is an example) &lt;fzero@rubi.gd&gt;
ssb   rsa4096/E713A00C 2016-04-08 [E]
ssb   rsa4096/6D49C7B5 2016-04-08 [S] [expires: 2018-04-08]
ssb   rsa4096/12FAAB7D 2016-04-08 [S] [expires: 2018-04-08]
</code></pre>

<p>کلید اصلی کنارش یه علامت # هست. <code>sec#</code> که این نشون میده که کلید توی این کلیدها نیست! خوب تبریک میگم، موفق شدید.</p>

<p>حالا میتونید از کلید بدون کلید اصلی هم export بگیرید.
برای اینکار کافیه که همون دستورهایی که قبلا برای اینکار زدیم رو استفاده کنید، فقط مطمئن شید که فایل اصلی که دفعه قبلی export گرفتید رو رونویسی نمیکنید و از بین نمیبرید :</p>

<pre><code>gpg --export-secret-keys --armor fzero@rubi.gd &gt; no-master-private-gpg-key-fzeo-rubi-gd.private
</code></pre>

<h2 id="جمع-بندی-نهایی:15e4b036b1a6dfc4502d5b7e8e5dc87b">جمع بندی نهایی</h2>

<p>الان تعداد فایلهایی که دارید ۴ تاست. یک کلید عمومی، یک کلید خصوصی با کلید اصلی، یک کلید خصوصی بدون کلید اصلی و یک گواهی برای <code>revoke</code></p>

<p>کلید عمومی که تکلیفش معلومه. گواهی هم که گفتم اگه منم که پرینت مکنم و اصلا به فایلش اعتماد نمیکنم.</p>

<p>کلید خصوصی با کلید اصلی هم تو یه سیستم امن نگه میدارم، و روی لپتاپ خودم هم کلید خصوصی بدون کلید اصلی رو هم ‍‍<code>import</code> میکنم و فایلش رو هم سر به نیست میکنم.</p>

<p>برای <code>import</code> کلید اینطوری عمل کنید :</p>

<pre><code>gpg --import /parth/to/public-key.public /path/to/private-key.private 
</code></pre>

<p>و البته بعد از زدن رمز، مجددا فایل تو سیستم شما وارد میشه.</p>

<p>از این به بعد یه سری ترفند برای استفاده از این کلیدهاست. دیگه کار اجباری ای نیست خوندنشون</p>

<h1 id="انتشار-کلید:15e4b036b1a6dfc4502d5b7e8e5dc87b">انتشار کلید</h1>

<p>برای اینکار، همونطور که قبلا گفتم میتونید کلید رو به هر روشی که دوست دارید به دست دیگران برسونید. ولی بهترین روش، انتشارش توی <code>keyserver‍</code> هاست.
من شخصا تو سرور <code>mit</code> منتشر میکنم. منتها سرور <code>ubuntu‍</code> هم هست اصولا فرق خاصی نداره، همشون با هم سینک میشن. ابزار تو لینوکس براش زیاده ولی خط فرمانیش :</p>

<p><code>gpg --send-keys KEY_ID --keyserver hkp://subkeys.pgp.net</code></p>

<p>KEY_ID هم میتونید با زدن <code>gpg --list-keys</code> ببینید. راه دوم هم اینه که فقط برید به آدرس <a href="http://pgp.mit.edu/">http://pgp.mit.edu/</a> و توی باکسی که هست، کل اون فایل کلید عمومی رو کپی کنید و تموم :)</p>

<h2 id="امضای-کامیت-ها-و-تگها:15e4b036b1a6dfc4502d5b7e8e5dc87b">امضای کامیت ها و تگها</h2>

<p>گفتم که برای امضای کامیتهام از این روش استفاده میکنم. برای اینکار
 git نسخه ۱.۷ به بالا احتیاج دارید که اگه ندارید واقعا توصیه میکنم سیستمتون رو آپدیت کنید :)))
 همین چند روز پیش، گیتهاب قابلیت تعیین اعتبار رو به سیستمش اضافه کرد، و اصلا انگیزه من از نوشتن این مطلب، همون بود و البته نباید نقش <a href="https://twitter.com/meysampg">@meysampg</a> رو نادیده گرفت :)))</p>

<p><img src="http://fzero.rubi.gd/images/gpg/gpg-github.png" alt="git commit verify- github" /></p>

<p>برای اینکار سوییچ S توسط گیت معرفی شده :</p>

<pre><code> -S[&lt;keyid&gt;], --gpg-sign[=&lt;keyid&gt;]
           GPG-sign commits. The keyid argument is optional and defaults to the committer identity; if specified, it must be stuck to the option without a space.
</code></pre>

<p>راحت ترین حالت اینه که کلید gpg شما با هویت شما توی گیت یکی باشه.
یعنی اون زمانی که دارید کلید gpg رو میسازید، اسم و ایمیلی رو بدید که برای گیت کانفیگ کردید و توی فایل کانفیگ گلوبال گیت هست . برای دیدن هویت خودتون توی گیت اینو بزنید :</p>

<pre><code>git config --global --get &quot;user.name&quot;
git config --global --get &quot;user.email&quot;
</code></pre>

<p>اولی باید همون چیزی باشه که به عنوان <code>Real name</code> وقت ساختن کلید اضافه کردید، و دومی هم ایمیل ثبت شدست.
اگر فرق میکنه، میتونید یه UID دیگه اضافه کنید یا اینکه وقت کامیت به <code>-S</code> شناسه کلید رو هم اضافه کنید که مثلا من چند خط بالاتر کلیدم رو با <code>list-keys</code> نشون دادم :</p>

<pre><code>ssb   rsa4096/12FAAB7D 2016-04-08 [S] [expires: 2018-04-08]
</code></pre>

<p>میشه <code>12FAAB7D</code></p>

<p>یه نکته هم آرش تو کامنتها گفت. ظاهرا تو نسخه ۲ به بعد میشه به صورت کلی رو یه رپو، تنظیم کرد که گیت کل کامیتها رو امضا کنه :</p>

<pre><code>git config commit.gpgsign true
</code></pre>

<p>و حتی میشه تنظیمات کلی گیت رو دستکاری کرد و پیش فرض سیستم رو تغییر داد :</p>

<pre><code>git config --global commit.gpgsign true
</code></pre>

<h1 id="افزودن-یک-ایمیل-به-کلید:15e4b036b1a6dfc4502d5b7e8e5dc87b">افزودن یک ایمیل به کلید</h1>

<p>گاهی لازم میشه که یک ایمیل دیگه اضافه کنید. مثل حالتی که بالا گفتم. فرض کنید از ایمیل شرکتی برای کامیت استفاده میکنید و میخواید کامیت رو ساین کنید. یک راه اینه که شناسه کلید رو بزنید، اما راه دوم اینه که ایمیل رو به کلید اضافه کنید . برای اینکار نمیشه از کلید بدون کلید اصلی استفاده کرد. (یکی از دلایلی که اون همه دردسر کشیدیم همین بود :) )
برید روی سیستمی که به کلید اصلی دسترسی دارید و دستور ویرایش رو بزنید :</p>

<script type="text/javascript" src="https://asciinema.org/a/8izog2t7i9wqae136ladxr94d.js" id="asciicast-8izog2t7i9wqae136ladxr94d" async></script>

<p>اول <code>adduid</code> رو بزنید و یه ایمیل جدید اضافه کنید. بعدش این ایمیل انتخاب شدست، شما کافیه <code>addkey</code> رو بزنید تا یک کلید به این هویت اضافه بشه، درنهایت <code>save</code> و تمام.</p>

<h1 id="حذف-یک-کلید:15e4b036b1a6dfc4502d5b7e8e5dc87b">حذف یک کلید</h1>

<p>برای اینکه یه کلید رو حذف کنید به هر دلیلی، کافیه کلید اصلی رو ویرایش کنید (کلید بدون کلید اصلی نمیتونه همچین کاری کنه) :</p>

<script type="text/javascript" src="https://asciinema.org/a/1c8hy0wef8sfyika113l0mr80.js" id="asciicast-1c8hy0wef8sfyika113l0mr80" async></script>

<p>تو این یکی، من یه سری متن هم با کلید # زدم که کامنت هستن، ممکنه یه کم گیج کننده باشه ولی لازم بود. با زدن <code>key 1</code> کلید شماره یک انتخاب میشه و با دوباره زدنش کلید از حالت انتخاب خارج میشه.
میتونید چند تا کلید رو انتخاب کنید و درنهایت کلیدهای انتخاب شده رو با <code>revkey</code> غیرفعال کنید و بعدش هم ذخیره کنید و تمام.</p>

<h1 id="وقتی-که-کلید-منقضی-شد-چی:15e4b036b1a6dfc4502d5b7e8e5dc87b">وقتی که کلید منقضی شد چی؟</h1>

<p>یه نکته‌ای که امروز متوجهش شدم (یکی دو ماهی بعد نوشتن اصل متن) اینه که خوب، زیر کلید یه جایی منقضی میشه. مثلا بعد یک سال. خوب بعد چی؟ یه کلید دیگه بسازیم؟ درستش اینه که نه. زیر کلید قبلی، از اون تاریخ به بعد اعتبار نداره. همه امضاهاش بی اعتبار میشن، مثلا کامیتهای ساین شده گیت با رنگ قرمز نشون داده میشن، البته اگه کلید گم شده باشن، این کمترین نگرانی شماست :) ولی اگر کلیدها رو دارید، بهترین کارش اینه که کلید رو تمدید کنید.
اگر دسترسی نداشتید که خوب هیچ، در غیر اینصورت بهتره مجددا کلید اصلی رو تو یه کامپیوتر امن، <code>import</code> کنید و بعدش بزنید <code>gpg --edit-key fzero@rubi.gd</code> گام بعدی انتخاب کلیده. با دستور <code>key n</code> کلید رو انتخاب کنید n میشه شماره کلید توی لیست. ایندکسها از صفر شروع میشن.
بعد از اینکار، کنار کلید یه علامت ستاره میاد.اونوقت میتونید با دستورات مختلف با این کلید (که حالا انتخاب شده) کار کنید و بعد با <code>expire</code> تاریخ انقضای کلید رو میشه تغییر داد.</p>

<script type="text/javascript" src="https://asciinema.org/a/753mma4abens0s1wa6za1m2gc.js" id="asciicast-753mma4abens0s1wa6za1m2gc" async></script>

<p>&ndash; یه کم تو ترمینال مشکل داشتم وقت رکورد این، رمز هم دو دفعه اشتباه زدم :/ یادم هم رفت آخرش <code>save</code> رو بزنم، به جاش <code>ctrl+d‍‍</code> رو زدم که میپرسه میخوای ذخیره کنی یا نه، نتیجه آخرش یکیه.</p>

<h1 id="افزودن-عکس-به-کلید:15e4b036b1a6dfc4502d5b7e8e5dc87b">افزودن عکس به کلید</h1>

<p>اینکه اینکار درسته یا نه، به اعتقادات خودتون برمیگرده. من بدم نمیاد، بعضی ها ممکنه دوست نداشته باشن :)
چند تا نکته، اول اینکه عکس کم حجم باشه. چون به کلید عمومی اضافه میشه و حجم کلید عمومی بهتره پایین بمونه جون مدام درحال دست به دست شدنه.
دوم اینکه فایل باید jpg باشه. تا جایی که میدونم این فقط تو استاندارد اومده نه png یا هر پسوند دیگه ای.</p>

<p>خیلی سادست، بازهم کلید gpg رو با <code>--edit-key</code> باز کنید و اینبار دستور <code>addphoto</code> رو بزنید.</p>

<script type="text/javascript" src="https://asciinema.org/a/8q538q271rso9uwqu4wz4tgc4.js" id="asciicast-8q538q271rso9uwqu4wz4tgc4" async></script>

<p>دقت کنید که به عکس ۱۱ کیلوبایتی من میگه خیلی بزرگ، که البته حق داره، سبیلهام توی اون عکس خودشون ۱۰-۱۱ کیلویی هستن.</p>

<p>&mdash; دیگه خسته شدم :) این مطلب رو هر موقع حسش باشه آپدیت میکنم و مطالب مرتبط رو اضافه میکنم. شما هم اگه دوست دارید اصلاحیه بزنید یا هر چی اضافه کنید، گیتهاب و پول ریکوئست شما را میخواند :) &mdash;</p>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "fzerorubigd";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "fzerorubigd";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://fzero.rubi.gd/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

